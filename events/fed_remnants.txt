namespace = feddie

# Feddie Remnants
country_event = {
	id = feddie.1
	title = "feddie.1.name"
	desc = "feddie.1.desc"
	picture = GFX_evt_Fed_Remnants
	show_sound = event_space_battle
	
	trigger = {
		has_country_flag = Zeon_Start
		NOT = { has_country_flag = fed_remnants }
		exists = capital_scope
		capital_scope = {
			solar_system = {
				ROOT = {
					any_controlled_planet = {
						OR = { 
							has_mining_station = yes 
							has_research_station = yes
						}
						solar_system = {
							NOT = { is_same_value = PREVPREVPREV }
						}
					}
				}
			}
		}
	}
	
	immediate = {
		set_country_flag = fed_remnants
		set_country_flag = birth_of_piracy
		capital_scope = { save_event_target_as = capital }
		capital_scope = {
			solar_system = { save_event_target_as = capital_system }
		}
		save_event_target_as = pirate_target
		owner_species = { save_event_target_as = owner_species }
		
		random_system = {
			limit = {
				distance = {
					source = event_target:capital
					max_distance = 60
					min_distance = 5
				}
				any_planet = { is_asteroid = yes }
				NOT = { has_star_flag = hostile_system }
				OR = {
					has_owner = no
					is_owned_by = ROOT
				}
			}
			random_system_planet = {
				limit = { is_asteroid = yes }
				save_event_target_as = pirate_home
				create_country = {
					name = "EFSF Remnants"
					type = pirate
					species = event_target:owner_species
					name_list = "Human"
					flag = {
						icon= {
							category = "human"
							file = "flag_human_9.dds"
						}
						background= {
							category = "backgrounds"
							file = "00_solid.dds"
						}
						colors={
							"blue"
							"black"
							"null"
							"null"
						}
					}
				}
				last_created_country = {
					set_name = random
					save_event_target_as = pirate_band
					set_relation_flag = {
						who = ROOT
						flag = pirate_relation
					}
					establish_communications_no_message = ROOT
						
					create_fleet = { name = "EFSF Remnants Base" }
					if = {
						limit = {
							root = { has_technology = tech_mass_drivers_1 }
						}
						last_created_fleet = {
							set_owner = PREV
							create_ship = {
								name = random
								design = "Pirate Nest"
								graphical_culture = "pirate_01"
							}
							set_location = PREVPREV
						}
					}
					if = {
						limit = {
							root = { has_technology = tech_lasers_1 }
						}
						last_created_fleet = {
							set_owner = PREV
							create_ship = {
								name = random
								design = "Pirate Lair"
								graphical_culture = "pirate_01"
							}
							set_location = PREVPREV
						}
					}
					if = {
						limit = {
							root = { has_technology = tech_missiles_1 }
						}
						last_created_fleet = {
							set_owner = PREV
							create_ship = {
								name = random
								design = "Pirate Den"
								graphical_culture = "pirate_01"
							}
							set_location = PREVPREV
						}
					}
					create_leader = {
						type = admiral
						species = owner_main_species
						name = random
						gender = male
						skill = 100
					}
					create_fleet = { name = "Londo Bell" }
					last_created_fleet = {
						set_fleet_stance = aggressive
						set_aggro_range_measure_from = self
						set_aggro_range = 150
						set_owner = PREV
						create_ship_design = {
							design = "Salamis"
							ftl = ROOT
						}
						create_ship = {
							name = random
							design = last_created_design
							graphical_culture = "fed_01"
						}
						create_ship = {
							name = random
							design = last_created_design
							graphical_culture = "fed_01"
						}
						create_ship = {
							name = random
							design = last_created_design
							graphical_culture = "fed_01"
						}
						create_ship = {
							name = random
							design = last_created_design
							graphical_culture = "fed_01"
						}
						assign_leader = last_created_leader
						set_location = PREVPREV
							
						queue_actions = {
							repeat = {
								find_random_system = {
									trigger = {
										id = "feddie.1.trigger.1"
										NOT = { 
											has_star_flag = hostile_system 
											is_same_value = event_target:capital_system
										}
										any_planet = {
											OR = {
												has_mining_station = yes
												has_research_station = yes
											}
											exists = controller
											controller = { is_same_value = event_target:pirate_target }
										}
										distance = {
											source = PREV
											max_distance = 100
											min_distance = 20
										}
									}
									found_system = {
										move_to = THIS
									}	
								}
								find_closest_planet = {
									trigger = {
										id = "feddie.1.trigger.2"
										OR = {
											has_mining_station = yes
											has_research_station = yes
										}
									}
									found_planet = {
										orbit_planet = THIS
										wait = {
											duration = 20
										}
									}
								}
								find_random_system = {
									trigger = {
										id = "feddie.1.trigger.3"
										any_planet = {
											is_planet = event_target:pirate_home
										}
									}
									found_system = {
										move_to = THIS
									}	
								}
								find_closest_planet = {
									trigger = {
										id = "feddie.1.trigger.4"
										is_planet = event_target:pirate_home
									}
									found_planet = {
										orbit_planet = THIS
										wait = {
											duration = 200
											random = 150
										}
									}
								}
							}
						}
					}
					if = {
						limit = {
							ROOT = { has_technology = "tech_warp_drive_1" }
						}
						set_country_flag = warp_pirates
						else = {
							if = {
								limit = {
									ROOT = { has_technology = "tech_hyper_drive_1" }
								}
								set_country_flag = hyper_pirates
							}
						}
					}
				}
			}
		}
	}
}